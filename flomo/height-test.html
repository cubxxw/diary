<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é«˜åº¦ä¿®å¤æµ‹è¯• - flomoå¢å¼ºç‰ˆ</title>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }
    
    .test-header {
      background: #30cf79;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    
    .test-info {
      background: white;
      padding: 10px;
      border-bottom: 1px solid #eee;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    .test-info span {
      margin: 2px 5px;
    }
    
    .status-good { color: #28a745; font-weight: bold; }
    .status-bad { color: #dc3545; font-weight: bold; }
    .status-info { color: #17a2b8; font-weight: bold; }
    
    .iframe-container {
      height: calc(100vh - 80px);
      display: flex;
      flex-direction: column;
    }
    
    iframe {
      width: 100%;
      flex: 1;
      border: none;
      background: white;
    }
    
    .controls {
      background: white;
      padding: 5px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 5px;
      justify-content: center;
    }
    
    button {
      background: #30cf79;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
      cursor: pointer;
    }
    
    button:hover {
      background: #28b66a;
    }
  </style>
</head>
<body>
  <div class="test-header">
    ğŸ“ é«˜åº¦ä¿®å¤æµ‹è¯•é¢æ¿ - flomoå¢å¼ºç‰ˆ
  </div>
  
  <div class="test-info">
    <span>ğŸ“± å±å¹•: <span id="screen-size"></span></span>
    <span>ğŸ“ iframeé«˜åº¦: <span id="iframe-height"></span></span>
    <span>ğŸ”§ ä¿®å¤çŠ¶æ€: <span id="fix-status" class="status-info">æ£€æµ‹ä¸­...</span></span>
    <span>â° æ—¶é—´: <span id="current-time"></span></span>
  </div>
  
  <div class="iframe-container">
    <iframe id="test-iframe" src="./enhancer.html"></iframe>
  </div>
  
  <div class="controls">
    <button onclick="refreshIframe()">ğŸ”„ åˆ·æ–°iframe</button>
    <button onclick="checkHeight()">ğŸ“ æ£€æŸ¥é«˜åº¦</button>
    <button onclick="forceResize()">ğŸ¯ å¼ºåˆ¶è°ƒæ•´</button>
    <button onclick="openOriginal()">ğŸš€ åŸå§‹é¡µé¢</button>
  </div>

  <script>
    let statusCheckInterval;
    
    function updateStatus() {
      const screenSize = document.getElementById('screen-size');
      const iframeHeight = document.getElementById('iframe-height');
      const fixStatus = document.getElementById('fix-status');
      const currentTime = document.getElementById('current-time');
      const iframe = document.getElementById('test-iframe');
      
      // å±å¹•å°ºå¯¸
      screenSize.textContent = `${window.innerWidth}Ã—${window.innerHeight}`;
      
      // iframeé«˜åº¦
      const iframeRect = iframe.getBoundingClientRect();
      iframeHeight.textContent = `${Math.round(iframeRect.height)}px`;
      
      // ä¿®å¤çŠ¶æ€æ£€æµ‹
      const expectedMinHeight = window.innerHeight - 150; // å¤§æ¦‚çš„æœ€å°é«˜åº¦
      if (iframeRect.height >= expectedMinHeight) {
        fixStatus.textContent = 'âœ… é«˜åº¦æ­£å¸¸';
        fixStatus.className = 'status-good';
      } else if (iframeRect.height < expectedMinHeight * 0.5) {
        fixStatus.textContent = 'âŒ é«˜åº¦è¿‡å°';
        fixStatus.className = 'status-bad';
      } else {
        fixStatus.textContent = 'âš ï¸ é«˜åº¦åå°';
        fixStatus.className = 'status-info';
      }
      
      // å½“å‰æ—¶é—´
      currentTime.textContent = new Date().toLocaleTimeString();
    }
    
    function refreshIframe() {
      const iframe = document.getElementById('test-iframe');
      iframe.src = iframe.src;
      setTimeout(updateStatus, 1000);
    }
    
    function checkHeight() {
      updateStatus();
      
      // å°è¯•è°ƒç”¨iframeå†…çš„ä¿®å¤å‡½æ•°
      try {
        const iframe = document.getElementById('test-iframe');
        if (iframe.contentWindow && iframe.contentWindow.fixHeightIssues) {
          iframe.contentWindow.fixHeightIssues();
          setTimeout(updateStatus, 500);
        }
      } catch (e) {
        console.log('æ— æ³•è°ƒç”¨iframeå†…çš„ä¿®å¤å‡½æ•°:', e);
      }
    }
    
    function forceResize() {
      // å¼ºåˆ¶è§¦å‘resizeäº‹ä»¶
      window.dispatchEvent(new Event('resize'));
      
      // å°è¯•æ‰‹åŠ¨è°ƒæ•´iframeé«˜åº¦
      const iframe = document.getElementById('test-iframe');
      const container = document.querySelector('.iframe-container');
      const containerHeight = container.offsetHeight;
      
      iframe.style.height = containerHeight + 'px';
      
      setTimeout(() => {
        iframe.style.height = '100%';
        updateStatus();
      }, 500);
    }
    
    function openOriginal() {
      window.open('./enhancer.html', '_blank');
    }
    
    // ç›‘å¬iframeåŠ è½½å®Œæˆ
    document.getElementById('test-iframe').addEventListener('load', function() {
      setTimeout(updateStatus, 1000);
      
      // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
      window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'HEIGHT_FIX_COMPLETE') {
          setTimeout(updateStatus, 100);
        }
      });
    });
    
    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', function() {
      setTimeout(updateStatus, 200);
    });
    
    // å®šæœŸæ›´æ–°çŠ¶æ€
    statusCheckInterval = setInterval(updateStatus, 2000);
    
    // åˆå§‹æ›´æ–°
    setTimeout(updateStatus, 500);
    
    // é¡µé¢å¸è½½æ—¶æ¸…ç†
    window.addEventListener('beforeunload', function() {
      if (statusCheckInterval) {
        clearInterval(statusCheckInterval);
      }
    });
  </script>
</body>
</html>